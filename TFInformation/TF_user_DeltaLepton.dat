<file>## ##################################################################
##                                          ##
##                          Matrix Element                               ##
##                          ==============                               ##
##                                                                       ##
##		    Generate the transfer functions                         ##
##	             -------------------------------                        ##
## 	     			                                            ##
##				                                            ##
##    Author: Annik Olbrechts (VUB)                                      ##
##   			                                            ##
##    Version:     1.0.0                         		            ##
##    Last change: 02/02/15			                            ##
##					                                    ##
###########################################################################
###########################################################################
##				                                            ##
##    Instructions:			                                    ##
##								            ##
##	- This program  creates transfer functions in THETA/PHI/E           ##
##	- Those functions must be defined in f77 standard                   ##
##	- In addition to each transfer function(START_TF), you MUST give    ##
##	   the typical width associated to your function (START_WIDTH)	    ##
##      - If a transfer functions is not defined here it will by default ##
##          - equals to one for neutrino/neutralino                      ##
##          - a delta functions for the rest                             ##
###########################################################################
##                                                                       ##
##   Syntax/variables:                                                   ## 
##                                                                       ##
##  - a definition for transfer functions should define the variable tf  ##
##    while a definition for the width shoud define the variable width   ## 
##	- You can use all standard f77 functions. (All variables are	    ##
##		in double precision format). 	                            ##
##	- The experimental event is  defined by the variable pexp(i)        ##
##		i=0->3 (0->E,1->Px,2->Py,3->Pz)	                            ##
##	- The partonic event is defined by the variable p(i)   	            ##
##		i=0->3 (0->E,1->Px,2->Py,3->Pz)			            ##
##		sigma can not depend on those variables		            ##
##	- You can use 10 local variables			            ##
##		(double precision):  prov1,prov2,...,prov10	            ##
##	- You can call specific functions on p or pexp:	                    ##
##		-pt(p)   : transverse momenta 			            ##
##		-eta(p)  : pseudo-rapidity			            ##
##		-rap(p)  : rapidity					    ##
##		-theta(p): polar angle				            ##
##		-phi(p)	 : azimuthal angle		  	     	    ##
##	- The whole LHCO information is available.                          ##
##              -run_number,trigger                       	 	    ##
##		-eta_init(N),phi_init(N),pt_init(N)                         ##
##              -j_mass(N),ntrk(N),btag(N),had_em(N)     	            ##
##		-dummy1(N),dummy2(N)		                            ##
##	    N is the LHCO tag(first column)	                            ##
##		- current tag is n_lhco  				    ##
##		- tag for missing ET is met_lhco			    ##
##				  					    ##
##	- You can incorporate parameters that will be passed through        ##
##	        the transfert_card.dat. Those ones must have the            ##
##		following syntax: #1,#2,#3,.. You can restart 		    ##
##		the assignement for each different transfer function	    ##
##	- In addition to each transfer function(tf_), you MUST give	    ##
##		the typical width associated to your function (sigma_)	    ##
##		This is needed for the phase space generator      	    ##
##									    ##
###########################################################################
###########################################################################

##**********************************************************************##
##             TF for bjet                                      
##**********************************************************************##
<block name='bjet'>   #name can be anything
  <info> double gaussian with parameter depending on the energy </info>
  <particles> b </particles>
  <width_type> thin </width_type>
  #width type should be thin or large (thin is for energy accurate up to 5-10%)
  <variable name='E'>
    <tf>
        prov1=(#1+#2*dsqrt(p(0))+#3*p(0))
        IF( p(0) .LE. 41.1111) THEN 
          prov1=-0.8767
        ENDIF 

        IF( p(0) .GE. 235.556) THEN 
          prov1 = 5.65782
        ENDIF 

        prov2=(#4+#5*dsqrt(p(0))+#6*p(0))
        IF( p(0) .LE. 41.1111) THEN 
          prov2=7.12828
        ENDIF 

        IF( p(0) .GE. 235.556) THEN 
          prov2 = 32.4861
        ENDIF 

        prov3=(#7+#8*dsqrt(p(0))+#9*p(0))
        IF( p(0) .LE. 41.1111) THEN 
          prov3=0.0627626
        ENDIF 

        IF( p(0) .GE. 235.556) THEN 
          prov3 = 0.229706
        ENDIF 

        prov4=(#10+#11*dsqrt(p(0))+#12*p(0))
        IF( p(0) .LE. 41.1111) THEN 
          prov4=-218.747
        ENDIF 

        IF( p(0) .GE. 235.556) THEN 
          prov4 = 187.447
        ENDIF 

        prov5=(#13+#14*dsqrt(p(0))+#15*p(0))
        IF( p(0) .LE. 41.1111) THEN 
          prov5=160.043
        ENDIF 

        IF( p(0) .GE. 235.556) THEN 
          prov5 = 148.546
        ENDIF 


        tf=(exp(-(p(0)-pexp(0)-prov1)**2/2d0/prov2**2))          !first gaussian
        tf=tf+prov3*(exp(-(p(0)-pexp(0)-prov4)**2/2d0/prov5**2)) !second gaussian
        tf=tf*((1d0/dsqrt(2d0*pi))/(dsqrt(prov2*prov2)+prov3*dsqrt(prov5*prov5)))            !normalisation
    </tf> 
    <width>
        prov2=(#4+#5*dsqrt(pexp(0))+#6*pexp(0))
        prov5=(#13+#14*dsqrt(pexp(0))+#15*pexp(0))
 
        width = max(prov2, prov5) 
    </width> 
  </variable>
</block>
##**********************************************************************##
##             TF for nonbjet                                      
##**********************************************************************##
<block name='nonbjet'>   #name can be anything
  <info> double gaussian with parameter depending on the energy </info>
  <particles> u,d,s,c,g </particles>
  <width_type> thin </width_type>
  #width type should be thin or large (thin is for energy accurate up to 5-10%)
  <variable name='E'>
    <tf>
        prov1=(#1+#2*dsqrt(p(0))+#3*p(0))
        IF( p(0) .LE. 33.4375) THEN 
          prov1=-3.49307
        ENDIF 

        IF( p(0) .GE. 151.562) THEN 
          prov1 = -3.95067
        ENDIF 

        prov2=(#4+#5*dsqrt(p(0))+#6*p(0))
        IF( p(0) .LE. 33.4375) THEN 
          prov2=5.05119
        ENDIF 

        IF( p(0) .GE. 151.562) THEN 
          prov2 = 18.0245
        ENDIF 

        prov3=(#7+#8*dsqrt(p(0))+#9*p(0))
        IF( p(0) .LE. 33.4375) THEN 
          prov3=0.257713
        ENDIF 

        IF( p(0) .GE. 151.562) THEN 
          prov3 = 0.207595
        ENDIF 

        prov4=(#10+#11*dsqrt(p(0))+#12*p(0))
        IF( p(0) .LE. 46.0938) THEN 
          prov4=-35.3933
        ENDIF 

        IF( p(0) .GE. 164.219) THEN 
          prov4 = 4.59398
        ENDIF 

        prov5=(#13+#14*dsqrt(p(0))+#15*p(0))
        IF( p(0) .LE. 46.0938) THEN 
          prov5=17.3455
        ENDIF 

        IF( p(0) .GE. 164.219) THEN 
          prov5 = 44.9815
        ENDIF 


        tf=(exp(-(p(0)-pexp(0)-prov1)**2/2d0/prov2**2))          !first gaussian
        tf=tf+prov3*(exp(-(p(0)-pexp(0)-prov4)**2/2d0/prov5**2)) !second gaussian
        tf=tf*((1d0/dsqrt(2d0*pi))/(dsqrt(prov2*prov2)+prov3*dsqrt(prov5*prov5)))            !normalisation
    </tf> 
    <width>
        prov2=(#4+#5*dsqrt(pexp(0))+#6*pexp(0))
        prov5=(#13+#14*dsqrt(pexp(0))+#15*pexp(0))
 
        width = max(prov2, prov5) 
    </width> 
  </variable>
</block>
</file>
